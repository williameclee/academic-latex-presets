\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{environment}[2023/12/15]

\newlength{\@env@linewidth}
\setlength{\@env@linewidth}{3pt}

\mdfdefinestyle{leftmargin}{
	linecolor=\accentcolour, 
	linewidth=\@env@linewidth, 
	topline=false, bottomline=false, rightline=false, 
	innertopmargin=\@env@linewidth, innerbottommargin=\@env@linewidth, innerrightmargin=0pt
}
\mdfdefinestyle{rightmargin}{
	linecolor=\accentcolour, 
	linewidth=\@env@linewidth, 
	topline=false, bottomline=false, leftline=false, 
	backgroundcolor=\lightcolour, 
	innertopmargin=\@document@fontsize, innerbottommargin=\@document@fontsize
}

\newtheoremstyle%
	{customtheoremstyle}%
	{0}{0}{\normalfont}{}
	{\color{\accentcolour}\bfseries\sffamily}
	{}{\@document@fontsize}{\thmname{#1}\thmnumber{ #2}\thmnote{ #3 \ifx\relax#3\relax\else$\displaystyle$\fi}
}
\theoremstyle{customtheoremstyle}


% Theorem environments
\gdef\@env@theorem@title{Theorem}
\gdef\@env@definition@title{Definition}
\gdef\@env@lemma@title{Lemma}
\gdef\@env@corollary@title{Corollary}
\gdef\@env@remark@title{Remark}
\gdef\@env@example@title{Example}
\gdef\@env@exercise@title{Exercise}

% theorem
\newtheorem{mytheorem}{\@env@theorem@title}[section]
\newenvironment{theorem}{
	\begin{mdframed}[style=leftmargin]
	\begin{mytheorem}
}{
	\end{mytheorem}
	\end{mdframed}
}

% definition
\newtheorem{mydefinition}[mytheorem]{\@env@definition@title}
\newenvironment{definition}{
	\begin{mdframed}[style=leftmargin]
	\begin{mydefinition}
}{
	\end{mydefinition}
	\end{mdframed}
}

% lemma
\newtheorem{mylemma}[mytheorem]{\@env@lemma@title}
\newenvironment{lemma}{
	\begin{mdframed}[style=leftmargin]
	\begin{mylemma}
}{
	\end{mylemma}
	\end{mdframed}
}

% corollary
\newtheorem{mycorollary}{\@env@corollary@title}[mytheorem]
\newenvironment{corollary}{
	\begin{mdframed}[style=leftmargin]
	\begin{mycorollary}
}{
	\end{mycorollary}
	\end{mdframed}
}

% remark
\newtheorem{myremark}[mytheorem]{\@env@remark@title}
\newenvironment{remark}{
	\begin{mdframed}[style=leftmargin]
	\begin{myremark}
}{
	\end{myremark}
	\end{mdframed}
}

% example
\newtheorem{myexample}{\@env@example@title}[section]
\newenvironment{example}{
	\begin{mdframed}[style=rightmargin]
	\begin{myexample}
}{
	\end{myexample}
	\end{mdframed}
}

% exercise
\newtheorem{myexercise}[myexample]{\@env@exercise@title}
\newenvironment{exercise}{
	\begin{mdframed}[style=rightmargin]
	\begin{myexercise}
}{
	\end{myexercise}
	\end{mdframed}
}

%% Code displayment
\RequirePackage{listings}
\lstdefinestyle{myMatlabStyle}{
	%backgroundcolor=\color{backcolour},   
	commentstyle = \color{\secondarycolour},
	keywordstyle = \color{\accentcolour},
	numberstyle  = \ttfamily\color{gray},
	stringstyle  = \color{mypurple},
	basicstyle   = \ttfamily\small,
	breakatwhitespace = false,	     
	breaklines = true,	    	     
	captionpos = b,	    	    	
	keepspaces = true,	    	     
	numbers = left,	    	    	
	numbersep = 5pt,	    	      
	showspaces = false,	    	    
	showstringspaces = false,
	showtabs = false,	    	      
	tabsize = 4,
	language = Matlab,
	morekeywords = {on, off},
	deletekeywords={
		length, reshape, zeros, size, linspace, meshgrid, num2str, 
		log, abs, exp, sqrt, pi, 
		sin, asin, cos, acos, tan, atan, 
		max, min, mean, sum, 
		plot, surf, xlabel, ylabel, zlabel, hold,
		gray, 
		all, clear, load
	},
	morestring=*[d]{"},
	morecomment=[l][\textbf]{\%\%}
}
\lstset{style=myMatlabStyle}

% Custom commands
\newcommand{\customcode}[1]{
	\begin{mdframed}[
		innertopmargin=0pt, innerbottommargin=0pt, 
		linewidth=3pt, 
		topline=false, bottomline=false, leftline=false, 
		backgroundcolor=lightgray, linecolor=gray
		]
		\setstretch{1}\lstinputlisting[xleftmargin=\parindent]{#1}
	\end{mdframed}
	}
\newenvironment{block_coloured}[1][]%
{\begin{mdframed}[style=rightmargin, innertopmargin=\@document@fontsize]
	\IfEqCase{#1}{
		{}{}%
	}[{{\sffamily\bfseries\color{\accentcolour}{#1}}}]}%
{\end{mdframed}}